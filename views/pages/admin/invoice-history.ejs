<!DOCTYPE html>
<html lang="id">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Riwayat Invoice - Admin Dashboard</title>
		<link rel="stylesheet" href="/css/admin-style.css" />
		<style>
			.filters {
				background: white;
				padding: 1.5rem;
				border-radius: 8px;
				margin-bottom: 2rem;
				display: grid;
				grid-template-columns: 1fr 1fr 1fr auto;
				gap: 1rem;
				align-items: end;
				box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
			}

			.filter-group {
				display: flex;
				flex-direction: column;
				gap: 0.5rem;
			}

			.filter-group label {
				font-size: 0.85rem;
				font-weight: 600;
				color: #555;
			}

			.filter-group input,
			.filter-group select {
				padding: 0.75rem;
				border: 1px solid #ddd;
				border-radius: 4px;
				font-size: 0.95rem;
				font-family: inherit;
			}

			.filter-group input::placeholder {
				color: #999;
			}

			.filter-group input:focus,
			.filter-group select:focus {
				outline: none;
				border-color: #667eea;
				box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
			}

			.btn-filter {
				padding: 0.75rem 1.5rem;
				background: #667eea;
				color: white;
				border: none;
				border-radius: 4px;
				cursor: pointer;
				font-size: 0.95rem;
				font-weight: 500;
				transition: all 0.2s;
			}

			.btn-filter:hover {
				background: #5568d3;
				transform: translateY(-1px);
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			}

			.btn-filter:active {
				transform: translateY(0);
			}

			.btn-filter.btn-reset {
				background: #6c757d;
				padding: 0.75rem 1rem;
			}

			.btn-filter.btn-reset:hover {
				background: #5a6268;
			}

			.table-container {
				background: white;
				border-radius: 8px;
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
				overflow: hidden;
			}

			.invoices-table {
				width: 100%;
				border-collapse: collapse;
			}

			.invoices-table thead {
				background: #f8f9fa;
				border-bottom: 2px solid #ddd;
			}

			.invoices-table th {
				padding: 1rem;
				text-align: left;
				font-weight: 600;
				color: #333;
				font-size: 0.9rem;
				text-transform: uppercase;
				letter-spacing: 0.5px;
			}

			.invoices-table td {
				padding: 1rem;
				border-bottom: 1px solid #eee;
				color: #666;
				font-size: 0.95rem;
			}

			.invoices-table tr:hover {
				background: #f9f9f9;
			}

			.invoice-number {
				font-weight: 600;
				color: #333;
			}

			.badge {
				display: inline-block;
				padding: 0.25rem 0.75rem;
				border-radius: 20px;
				font-size: 0.85rem;
				font-weight: 500;
			}

			.status-draft {
				background: #e2e3e5;
				color: #383d41;
			}
			.status-issued {
				background: #cfe2ff;
				color: #084298;
			}
			.status-sent {
				background: #cff4fc;
				color: #055160;
			}
			.status-paid {
				background: #d1e7dd;
				color: #0f5132;
			}
			.status-overdue {
				background: #f8d7da;
				color: #842029;
			}
			.status-cancelled {
				background: #f5c2c7;
				color: #842029;
			}

			.btn-small {
				display: inline-block;
				padding: 0.4rem 0.8rem;
				background: #667eea;
				color: white;
				text-decoration: none;
				border-radius: 4px;
				font-size: 0.85rem;
				transition: background 0.2s;
				border: none;
				cursor: pointer;
			}

			.btn-small:hover {
				background: #5568d3;
			}

			.actions {
				display: flex;
				gap: 0.5rem;
			}

			.pagination {
				display: flex;
				gap: 0.5rem;
				justify-content: center;
				margin-top: 2rem;
			}

			.pagination a,
			.pagination span {
				padding: 0.5rem 0.75rem;
				border: 1px solid #ddd;
				border-radius: 4px;
				text-decoration: none;
				color: #667eea;
				transition: all 0.2s;
			}

			.pagination a:hover {
				background: #667eea;
				color: white;
			}

			.pagination span.active {
				background: #667eea;
				color: white;
				border-color: #667eea;
			}

			.pagination span.disabled {
				color: #ccc;
				cursor: not-allowed;
			}

			.empty-state {
				padding: 3rem;
				text-align: center;
				color: #999;
			}

			.empty-state p {
				margin-bottom: 1rem;
				font-size: 1rem;
			}

			@media (max-width: 1024px) {
				.filters {
					grid-template-columns: 1fr 1fr;
				}
			}

			@media (max-width: 768px) {
				.filters {
					grid-template-columns: 1fr;
					gap: 1rem;
				}

				.filter-group {
					width: 100%;
				}

				.filter-group input,
				.filter-group select {
					width: 100%;
				}

				.btn-filter {
					width: 100%;
				}

				.table-container {
					border-radius: 0;
					box-shadow: none;
					border: 1px solid #eee;
				}

				.invoices-table {
					font-size: 0.8rem;
				}

				.invoices-table th {
					padding: 0.75rem 0.5rem;
					font-size: 0.75rem;
					text-transform: none;
					letter-spacing: 0;
				}

				.invoices-table td {
					padding: 0.75rem 0.5rem;
					font-size: 0.8rem;
				}

				.invoice-number {
					display: block;
					margin-bottom: 0.25rem;
				}

				.actions {
					flex-direction: column;
					gap: 0.25rem;
				}

				.btn-small {
					width: 100%;
					text-align: center;
					padding: 0.35rem 0.5rem;
					font-size: 0.75rem;
				}

				.badge {
					font-size: 0.7rem;
					padding: 0.2rem 0.5rem;
				}

				.pagination {
					flex-wrap: wrap;
					gap: 0.25rem;
				}

				.pagination a,
				.pagination span {
					padding: 0.4rem 0.6rem;
					font-size: 0.8rem;
				}
			}

			@media (max-width: 480px) {
				.table-container {
					overflow-x: auto;
				}

				.invoices-table {
					min-width: 500px;
				}

				.main-content {
					padding: 1rem;
				}

				.top-bar {
					flex-direction: column;
					gap: 1rem;
				}
			}
		</style>
	</head>
	<body>
		<div class="admin-container">
			<!-- Sidebar Overlay -->
			<div class="sidebar-overlay" id="sidebarOverlay"></div>

			<!-- Sidebar -->
			<aside class="sidebar" id="sidebar">
				<div class="sidebar-header">
					<h2>E-Invoice</h2>
					<p>Restu Production</p>
				</div>

				<nav class="sidebar-nav">
					<a href="/admin/invoice/dashboard" class="nav-item">
						<span class="icon">ðŸ“Š</span>
						<span class="label">Dashboard</span>
					</a>
					<a href="/admin/invoice/create" class="nav-item">
						<span class="icon">âž•</span>
						<span class="label">Buat Invoice</span>
					</a>
					<a href="/admin/invoice/history" class="nav-item active">
						<span class="icon">ðŸ“‹</span>
						<span class="label">Riwayat Invoice</span>
					</a>
				</nav>

				<div class="sidebar-footer">
					<a href="/auth/logout" class="logout-btn">
						<span class="icon">ðŸšª</span>
						<span class="label">Logout</span>
					</a>
				</div>
			</aside>

			<!-- Main Content -->
			<main class="main-content">
				<div class="top-bar">
					<div class="top-bar-left">
						<button class="hamburger-menu" id="hamburgerMenu">â˜°</button>
						<h1>Riwayat Invoice</h1>
					</div>
				</div>

				<!-- Filters -->
				<div class="filters">
					<div class="filter-group">
						<label for="searchFilter">Cari Invoice</label>
						<input
							type="text"
							id="searchFilter"
							placeholder="Nomor invoice atau nama penerima..."
						/>
					</div>
					<div class="filter-group">
						<label for="dateFilter">Tanggal</label>
						<input type="date" id="dateFilter" />
					</div>
					<div class="filter-group">
						<label for="statusFilter">Status</label>
						<select id="statusFilter">
							<option value="">Semua Status</option>
							<option value="draft">Draft</option>
							<option value="issued">Diterbitkan</option>
							<option value="sent">Terkirim</option>
							<option value="paid">Dibayar</option>
							<option value="overdue">Jatuh Tempo</option>
							<option value="cancelled">Dibatalkan</option>
						</select>
					</div>
					<div style="display: flex; gap: 0.5rem">
						<button class="btn-filter" id="btnApplyFilters">Filter</button>
						<button class="btn-filter btn-reset" id="btnResetFilters">
							Reset
						</button>
					</div>
				</div>

				<!-- Table -->
				<div class="table-container">
					<% if (invoices && invoices.length > 0) { %>
					<table class="invoices-table">
						<thead>
							<tr>
								<th>No. Invoice</th>
								<th>Penerima</th>
								<th>Perusahaan</th>
								<th>Tanggal</th>
								<th>Total</th>
								<th>Status</th>
								<th>Aksi</th>
							</tr>
						</thead>
						<tbody>
							<% invoices.forEach(invoice => { %>
							<tr>
								<td>
									<span class="invoice-number">
										<%= invoice.invoice_number %>
									</span>
								</td>
								<td><%= invoice.recipient_name %></td>
								<td><%= invoice.company_name %></td>
								<td>
									<%= new Date(invoice.invoice_date).toLocaleDateString('id-ID')
									%>
								</td>
								<td>
									Rp <%= (invoice.total_amount || 0).toLocaleString('id-ID') %>
								</td>
								<td>
									<span class="badge status-<%= invoice.status %>">
										<%= invoice.status.toUpperCase() %>
									</span>
								</td>
								<td>
									<div class="actions">
										<a
											href="/admin/invoice/<%= invoice.id %>"
											class="btn-small"
										>
											Lihat
										</a>
										<a
											href="/admin/invoice/<%= invoice.id %>/pdf/normal"
											class="btn-small"
											download
										>
											PDF
										</a>
									</div>
								</td>
							</tr>
							<% }); %>
						</tbody>
					</table>

					<!-- Pagination -->
					<% if (totalPages > 1) { %>
					<div class="pagination">
						<% if (currentPage > 1) { %>
						<a href="?page=1">First</a>
						<a href="?page=<%= currentPage - 1 %>">Previous</a>
						<% } else { %>
						<span class="disabled">First</span>
						<span class="disabled">Previous</span>
						<% } %> <% for (let i = Math.max(1, currentPage - 2); i <=
						Math.min(totalPages, currentPage + 2); i++) { %> <% if (i ===
						currentPage) { %>
						<span class="active"><%= i %></span>
						<% } else { %>
						<a href="?page=<%= i %>"><%= i %></a>
						<% } %> <% } %> <% if (currentPage < totalPages) { %>
						<a href="?page=<%= currentPage + 1 %>">Next</a>
						<a href="?page=<%= totalPages %>">Last</a>
						<% } else { %>
						<span class="disabled">Next</span>
						<span class="disabled">Last</span>
						<% } %>
					</div>
					<% } %> <% } else { %>
					<div class="empty-state">
						<p>ðŸ“­ Belum ada invoice</p>
						<a href="/admin/invoice/create" class="btn-small">
							Buat Invoice Pertama
						</a>
					</div>
					<% } %>
				</div>
			</main>
		</div>

		<script>
			// Hamburger Menu Toggle
			const hamburger = document.getElementById("hamburgerMenu")
			const sidebar = document.getElementById("sidebar")
			const overlay = document.getElementById("sidebarOverlay")

			function toggleSidebar() {
				sidebar.classList.toggle("active")
				overlay.classList.toggle("active")
			}

			function closeSidebar() {
				sidebar.classList.remove("active")
				overlay.classList.remove("active")
			}

			hamburger.addEventListener("click", toggleSidebar)
			overlay.addEventListener("click", closeSidebar)

			// Close sidebar when clicking nav items
			document.querySelectorAll(".nav-item").forEach((item) => {
				item.addEventListener("click", closeSidebar)
			})

			let searchTimeout

			// Get URL params
			function getURLParams() {
				const params = new URLSearchParams(window.location.search)
				return {
					search: params.get("search") || "",
					date: params.get("date") || "",
					status: params.get("status") || "",
				}
			}

			// Set initial values from URL
			function initializeFilters() {
				const params = getURLParams()
				document.getElementById("searchFilter").value = params.search
				document.getElementById("dateFilter").value = params.date
				document.getElementById("statusFilter").value = params.status
			}

			// Apply filters with AJAX
			function applyFilters() {
				const search = document.getElementById("searchFilter").value
				const date = document.getElementById("dateFilter").value
				const status = document.getElementById("statusFilter").value

				const params = new URLSearchParams()
				if (search) params.append("search", search)
				if (date) params.append("date", date)
				if (status) params.append("status", status)
				params.append("page", "1")

				window.location.href = `?${params.toString()}`
			}

			// Reset filters
			function resetFilters() {
				document.getElementById("searchFilter").value = ""
				document.getElementById("dateFilter").value = ""
				document.getElementById("statusFilter").value = ""
				window.location.href = window.location.pathname
			}

			// Realtime search on input
			function handleSearchInput() {
				clearTimeout(searchTimeout)
				searchTimeout = setTimeout(() => {
					applyFilters()
				}, 500)
			}

			// Event listeners
			document.addEventListener("DOMContentLoaded", () => {
				initializeFilters()

				const searchInput = document.getElementById("searchFilter")
				const dateInput = document.getElementById("dateFilter")
				const statusSelect = document.getElementById("statusFilter")
				const btnApply = document.getElementById("btnApplyFilters")
				const btnReset = document.getElementById("btnResetFilters")

				// Realtime search
				searchInput.addEventListener("input", handleSearchInput)

				// Date filter realtime
				dateInput.addEventListener("change", applyFilters)

				// Status filter realtime
				statusSelect.addEventListener("change", applyFilters)

				// Button listeners
				btnApply.addEventListener("click", applyFilters)
				btnReset.addEventListener("click", resetFilters)

				// Enter key for search
				searchInput.addEventListener("keypress", (e) => {
					if (e.key === "Enter") {
						applyFilters()
					}
				})
			})
		</script>
	</body>
</html>
